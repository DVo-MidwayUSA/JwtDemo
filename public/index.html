<!doctype html>

<html lang="en">

<head>
    <meta charset="utf-8">

    <title>JWT Demo</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://kit.fontawesome.com/4d1b257183.js"></script>
    <style>
        .container {
            margin-top: 5em;
        }

        .fa-key {
            display: inline-block;
            margin-right: 0.5em;
        }
    </style>
</head>

<body>
    <div class="container px-lg-5">
        <div class="row">
            <div class="col-8">
                <div class="jumbotron">
                    <h1>Knock, knock. Do you want in?</h1>
                    <p>
                        Bacon ipsum dolor amet buffalo ham hock pork chop, ribeye frankfurter flank beef ribs leberkas
                        sirloin tongue. Strip steak pork kielbasa boudin landjaeger chicken shankle tongue. Turducken
                        drumstick ribeye porchetta brisket burgdoggen, andouille jowl leberkas shankle prosciutto cupim
                        pancetta.
                    </p>
                </div>
            </div>
            <div class="col-4">
                <form id="login">
                    <div class="form-group">
                        <label for="username">Username</label>
                        <input type="input" name="username" class="form-control" id="username"
                            placeholder="Enter your username" required>
                        <small id="usernameHelp" class="form-text text-muted">We'll never share your info with anyone
                            else.</small>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" name="password" class="form-control" id="password" placeholder="Password"
                            required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block"><i class="fas fa-key"></i> Let me
                        in!</button>
                </form>
                <div id="profile" class="card d-none">
                    <div class="card-body">
                        <h3 class="card-title">Hi <span></span></h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('login')
        const profile = document.getElementById('profile')

        form.addEventListener('submit', (event) => {
            event.preventDefault()
            const formData = formDataToJson(form)
            post('http://localhost:9999/login', formData)
                .then((response) => {
                    hide(form)
                    displayUsername(profile, response)
                    show(profile)
                })
        })

        const hide = (element) => {
            element.classList.add('d-none')
        }

        const show = (element) => {
            element.classList.remove('d-none')
        }

        const displayUsername = (profile, user) => {
            const title = profile.querySelector('h3 span')
            title.textContent = user.username
        }

        const formDataToJson = (form) => {
            const object = {}
            const formData = new FormData(form)
            formData.forEach((value, key) => { object[key] = value })
            return JSON.stringify(object)
        }

        const post = (url, data) => {
            return fetch(url, {
                method: 'PUT',
                body: data,
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include',
            }).then((response) => {
                return response.json()
            })
        }
    </script>
</body>

</html>